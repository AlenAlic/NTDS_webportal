{% extends "base.html" %}
{% import 'my_wtf.html' as my_wtf %}

{% block body_attribs %}
{% endblock %}

{% block app_content %}
<ul class="nav nav-tabs" id=myTabs role=tablist>
	<li role=presentation class=active>
		<a href=#overview id=overview-tab role=tab data-toggle=tab aria-controls=overview aria-expanded=true>Overview</a>
	</li>
    <li role=presentation>
        <a href=#config class=dropdown-toggle id=config-tab data-toggle=tab aria-controls=config-contents>Config</a>
    </li>
</ul>
<div class=tab-content id=myTabContent>
	<div class="tab-pane fade in active" role=tabpanel id=overview aria-labelledby=overview-tab>
        {% if state.main_raffle_taken_place is sameas false %}
            <h2>Raffle</h2>
            <p>Select any dancers you want to be guaranteed entry into the tournament from the lists below.</p>
            <form class="form" method="POST" enctype="multipart/form-data" novalidate>
                <button type="submit" id="submit-start_raffle" name="start_raffle" class="btn btn-success">Start Raffle</button>
                <!--<button type="submit" id="submit-start_test_raffle" name="start_test_raffle" class="btn btn-danger btn-lg"><strong>DEBUG RAFFLE - FOR TESTING PURPOSES ONLY</strong></button>-->
            </form>
            {% with title='Lists of all eligible dancers', teams=teams %}
                {% include 'organizer/_raffle_dancers_list_collapsible.html' %}
            {% endwith %}
        {% endif %}

        {% if state.main_raffle_taken_place is sameas true and state.main_raffle_result_visible is sameas false %}
        <h2>Raffle confirmation</h2>
        <p>If you are happy with the selected roster, click the button below to confirm it. This will make the results visible to the teamcaptains.</p>
        <p>Otherwise, you can redo the raffle, or cancel it.</p>
        <form class="form" method="POST" enctype="multipart/form-data" novalidate>
            <button type="submit" id="submit-confirm_raffle" name="confirm_raffle" class="btn btn-success">Confirm Raffle</button>
            <button type="submit" id="submit-redo_raffle" name="redo_raffle" class="btn btn-info">Redo Raffle</button>
            <button type="submit" id="submit-cancel_raffle" name="cancel_raffle" class="btn btn-warning">Cancel Raffle</button>
        </form>
        {% with title='Summary', desc='This will be the statistics if all the selected dancers are confirmed.', stats=stats_selected %}
            {% include 'organizer/_raffle_stats.html' %}
        {% endwith %}
        {% with title='Lists of selected dancers', teams=teams %}
            {% include 'organizer/_raffle_dancers_list_selected_collapsible.html' %}
        {% endwith %}
        {% endif %}

        {% if state.main_raffle_taken_place is sameas true and state.main_raffle_result_visible is sameas true %}
        {% with title='Summary selected dancers', stats=stats_selected %}
            {% include 'organizer/_raffle_stats.html' %}
        {% endwith %}
        {% with title='Summary confirmed dancers', stats=stats_confirmed %}
            {% include 'organizer/_raffle_stats.html' %}
        {% endwith %}
        {% with title='Lists of selected and confirmed dancers', teams=teams %}
            {% include 'organizer/_raffle_dancers_list_confirmed_collapsible.html' %}
        {% endwith %}
        {% endif %}
	</div>

    <div class="tab-pane fade" role=tabpanel id=config aria-labelledby=config-tab>
        <h2>Tournament config</h2>
        <form class="form" method="POST" enctype="multipart/form-data" novalidate>
            {% for key in raffle_config %}
            {% if key in data.raffle_config_items %}
                <div class="form-group">
                    <label>{{ data.raffle_labels[key] }}</label>
                    <input type="number" min="0" class="form-control" id="{{ key }}" name="{{ key }}" value="{{ raffle_config[key] }}">
                </div>
            {% endif %}
            {% endfor %}
            <button type="submit" id="submit-raffle_config"  name="raffle_config" class="btn btn-default">Save changes</button>
        </form>
        {% if state.main_raffle_result_visible is sameas true %}
        <h2>Reset raffle</h2>
        <p><strong>Warning!</strong> Doing this will redo the raffle entirely, without any way of getting this configuration back.</p>
        <form class="form" method="POST" enctype="multipart/form-data" novalidate>
            <button type="submit" id="submit-reset_raffle" name="reset_raffle" class="btn btn-danger">RESET Raffle</button>
        </form>
        {% endif %}
    </div>

</div>
{% endblock %}


{% block scripts %}
{{ super() }}
<script>
$(document).ready(function() {
    $('.table-clickable-checkbox tr').click(function(event) {
        if (event.target.type !== 'checkbox') {
            $(':checkbox', this).trigger('click');
        }
    });
});
$(document).ready(function($) {
    $(".clickable-row").css("cursor", "pointer")
    $(".checkbox").css("cursor", "pointer")
});
$(document).ready(function($) {
    $(".checkbox").change(function() {
        $(this).parents("tr:first").toggleClass('success ');
    });
});
</script>
{% endblock %}
