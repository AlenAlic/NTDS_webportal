{% extends "base.html" %}
{% import 'my_wtf.html' as my_wtf %}

{% block head %}
{{ super() }}
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/jquery.confirm.min.js"></script>
{% endblock %}

{% block app_content %}

{% if wide == 0 %}
<a href="{{ url_for('teamcaptains.edit_dancers', wide=1) }}" class="btn btn-default">Wide view</a>
<table class="table table-striped table-responsive">
    <thead>
        <tr>
            <th><b>#</b></th>
            <th><b>Name</b></th>
            <th><b>E-mail</b></th>
            <th><b>Status</b></th>
            <th><b>First time</b></th>
            <th><b>Student</b></th>
            <th><b>Ballroom</b></th>
            <th><b>Latin</b></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for dancer in dancers %}
            <tr>
                <td class="clickable-row" data-href="{{url_for('teamcaptains.edit_dancer', number=dancer.contestant_id, wide=wide)}}">
                    {{ dancer.contestant_info[0].number }}
                </td>
                <td class="clickable-row" data-href="{{url_for('teamcaptains.edit_dancer', number=dancer.contestant_id, wide=wide)}}">
                    {{ dancer.get_full_name() }}
                </td>
                <td class="clickable-row" data-href="{{url_for('teamcaptains.edit_dancer', number=dancer.contestant_id, wide=wide)}}">
                    {{ dancer.email }}
                </td>
                <td class="clickable-row" data-href="{{url_for('teamcaptains.edit_dancer', number=dancer.contestant_id, wide=wide)}}">
                    {{ data.STATUS[dancer.status_info[0].status] }}
                </td>
                <td class="clickable-row" data-href="{{url_for('teamcaptains.edit_dancer', number=dancer.contestant_id, wide=wide)}}">
                    {{ data.TF[dancer.contestant_info[0].first_time] }}
                </td>
                <td class="clickable-row" data-href="{{url_for('teamcaptains.edit_dancer', number=dancer.contestant_id, wide=wide)}}">
                    {{ data.TF[dancer.contestant_info[0].student] }}
                </td>
                <td class="clickable-row" data-href="{{url_for('teamcaptains.edit_dancer', number=dancer.contestant_id, wide=wide)}}">
                    {% if dancer.dancing_info[0].level != data.NO %}
                    {{ data.LEVELS[dancer.dancing_info[0].level] }}
                    {% else %} - {% endif %}
                </td>
                <td class="clickable-row" data-href="{{url_for('teamcaptains.edit_dancer', number=dancer.contestant_id, wide=wide)}}">
                    {% if dancer.dancing_info[1].level != data.NO %}
                    {{ data.LEVELS[dancer.dancing_info[1].level] }}
                    {% else %} - {% endif %}
                </td>
                <td align="right">
                    {% if dancer.status_info[0].status == data.REGISTERED or dancer.status_info[0].status == data.CANCELLED %}
                        <a id="{{ dancer.contestant_id }}" name="{{ dancer.contestant_id }}" role="button"
                        {% if dancer.status_info[0].status == data.REGISTERED %} class="btn btn-warning" href="{{ url_for('teamcaptains.register_dancer', number=dancer.contestant_id, register=0, wide=wide) }}">Cancel registration
                        {% elif dancer.status_info[0].status == data.CANCELLED %} class="btn btn-info" href="{{ url_for('teamcaptains.register_dancer', number=dancer.contestant_id, register=1, wide=wide) }}">Re-register
                        </a>
                        {% endif %}
                    {% endif %}
                    {% if dancer.status_info[0].status == data.SELECTED or dancer.status_info[0].status == data.CONFIRMED %}
                        <button class="btn btn-danger confirm-cancellation" data-url="{{ url_for('teamcaptains.register_dancer', number=dancer.contestant_id, register=0, send_message=true, wide=wide) }}" data-title="WARNING!" data-text="{% if dancer.status_info[0].status == data.CONFIRMED %}{{ dancer.get_full_name() }} is obliged to pay the admission fee, even upon cancelling.<br><br>{% endif %}Cancelling the registration will remove {% if dancer.status_info[0].status == data.CONFIRMED %}{{ dancer.first_name }}{% else %}{{ dancer.get_full_name() }}{% endif %} completely from the tournament.<br><br>Are you sure you want to cancel the registration of {{ dancer.first_name }}?" data-confirm-button="Yes, cancel registration of {{ dancer.first_name }}" data-confirm="cancelRegistration('{{ url_for('teamcaptains.register_dancer', number=dancer.contestant_id, register=0, wide=wide) }}')" data-cancel-button="No, keep {{ dancer.first_name }} registered">Cancel registration</button>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<a href="{{ url_for('teamcaptains.edit_dancers', wide=0) }}" class="btn btn-default navbar-btn">Short view</a>
<table class="table table-striped table-responsive">
    <thead>
        <tr>
            <th><b>#</b></th>
            <th><b>Name</b></th>
            <th><b>E-mail</b></th>
            <th><b>Status</b></th>
            <th><b>First time</b></th>
            <th><b>Student</b></th>
            <th><b>Ballroom level</b></th>
            <th><b>Ballroom role</b></th>
            <th><b>Latin level</b></th>
            <th><b>Latin role</b></th>
            <th><b>Sleeping spot</b></th>
            <!--<th><b>Diet/Allergies</b></th>-->
            <th><b>T-shirt</b></th>
            <!--<th><b>Volunteer</b></th>-->
            <!--<th><b>First Aid</b></th>-->
            <!--<th><b>Jury Ballroom</b></th>-->
            <!--<th><b>Jury Latin</b></th>-->
        </tr>
    </thead>
    <tbody>
        {% for dancer in dancers %}
            <tr class="clickable-row" data-href="{{url_for('teamcaptains.edit_dancer', number=dancer.contestant_id, wide=wide)}}">
                <td>
                    {{ dancer.contestant_info[0].number }}
                </td>
                <td>
                    {{ dancer.get_full_name() }}
                </td>
                <td>
                    {{ dancer.email }}
                </td>
                <td>
                    {{ data.STATUS[dancer.status_info[0].status] }}
                </td>
                <td>
                    {{ data.STUDENT_TEXT[dancer.contestant_info[0].student] }}
                </td>
                <td>
                    {{ data.TF[dancer.contestant_info[0].student] }}
                </td>
                <td>
                    {% if dancer.dancing_info[0].level != data.NO %}
                    {{ data.LEVELS[dancer.dancing_info[0].level] }}
                    {% else %} - {% endif %}
                </td>
                <td>
                    {% if dancer.dancing_info[0].role != data.NO %}
                    {{ data.ROLES[dancer.dancing_info[0].role] }}
                    {% else %} - {% endif %}
                </td>
                <td>
                    {% if dancer.dancing_info[1].level != data.NO %}
                    {{ data.LEVELS[dancer.dancing_info[1].level] }}
                    {% else %} - {% endif %}
                </td>
                <td>
                    {% if dancer.dancing_info[1].role != data.NO %}
                    {{ data.ROLES[dancer.dancing_info[1].role] }}
                    {% else %} - {% endif %}
                </td>
                <td>
                    {{ data.TF[dancer.additional_info[0].sleeping_arrangements] }}
                </td>
                <!--<td>-->
                    <!--{% if dancer.contestant_info[0].diet_allergies != None %}-->
                        <!--{{ dancer.contestant_info[0].diet_allergies }}-->
                    <!--{% endif %}-->
                <!--</td>-->
                <td>
                    {{ data.SHIRTS[dancer.additional_info[0].t_shirt] }}
                </td>
                <!--<td>-->
                    <!--{{ data.YMN[dancer.volunteer_info[0].volunteer] }}-->
                <!--</td>-->
                <!--<td>-->
                    <!--{{ data.YMN[dancer.volunteer_info[0].first_aid] }}-->
                <!--</td>-->
                <!--<td>-->
                    <!--{{ data.YMN[dancer.volunteer_info[0].jury_ballroom] }}-->
                <!--</td>-->
                <!--<td>-->
                    <!--{{ data.YMN[dancer.volunteer_info[0].jury_latin] }}-->
                <!--</td>-->
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
<script>
$.confirm.options = {
    confirmButtonClass: "btn-danger",
    cancelButtonClass: "btn-default",
    dialogClass: "modal-dialog"
}
$(".confirm-cancellation").confirm({
    confirm: function(button) {
        <!--alert("You just confirmed.");-->
        window.location.href = button.data('url');
    },
    cancel: function(button) {}
});
</script>
{% endblock %}


{% block scripts %}
{{ super() }}
<script>
$(document).ready(function($) {
    $(".clickable-row").css("cursor", "pointer")
    $(".clickable-row").click(function() {
        window.location = $(this).data("href");
    });
});
function cancelSelected(url, full_name, first_name) {
    if (confirm(`Cancelling the registration will remove ${full_name} completely from the tournament.\n\nAre you sure you want to cancel the registration of ${first_name}?`)) {
        window.location.href = url;
    }
};
function cancelConfirmed(url, full_name, first_name) {
    if (confirm(`WARNING! ${first_name} is obliged to pay the admission fee, even upon cancelling.\n\nCancelling the registration will remove ${full_name} completely from the tournament.\n\nAre you sure you want to cancel the registration of ${first_name}?`)) {
        window.location.href = url;
    }
};
function cancelRegistration(url) {
    window.location.href = url;
}
</script>
{% endblock %}
